# 配置指南

## 📋 快速开始

### 零配置使用（推荐）

大多数情况下，你**不需要任何配置**！只需：

1. 在项目根目录创建 `translations.txt`
2. 添加翻译内容（`key=value` 格式）
3. 开始使用

扩展会自动找到翻译文件并加载。

## 🔧 配置项说明

打开 VS Code 设置（`Ctrl+,`），搜索 "i18n Hover"，可以看到以下配置项：

### 1. 翻译文件路径 (translationFilePath)

**说明**：指定翻译文件的路径

**默认值**：空（自动查找）

**自动查找规则**：

未配置时，扩展会按顺序自动查找以下路径，使用第一个存在的文件：

1. `<工作区根目录>/translations.txt` （通用项目）
2. `<工作区根目录>/Library/EditorPerssitent/Locale/translation.txt` （Unity 项目）

**配置示例**：

```json
{
  // 相对路径（相对于工作区根目录）
  "i18nHover.translationFilePath": "i18n/zh_CN.txt",
  
  // 或绝对路径
  "i18nHover.translationFilePath": "D:/shared/translations.txt"
}
```

**使用场景**：

| 场景 | 是否需要配置 | 说明 |
|------|-------------|------|
| 根目录有 `translations.txt` | ❌ 不需要 | 自动识别 |
| Unity 项目 | ❌ 不需要 | 自动识别 Unity 路径 |
| 翻译文件在子目录 | ✅ 需要 | 配置相对路径 |
| 多项目共享翻译文件 | ✅ 需要 | 配置绝对路径 |

### 2. Key 匹配规则 (keyPattern)

**说明**：主要的翻译 key 匹配正则表达式

**默认值**：`^[a-zA-Z0-9_][a-zA-Z0-9_.-]*$`

**支持的格式**：

- ✅ 字母、数字、下划线、横线、点号
- ✅ 可以数字开头（适配游戏项目）

**匹配示例**：

```javascript
"BTN_OK"              // ✅ 大写+下划线
"btn-ok"              // ✅ 小写+横线
"ui.main.menu"        // ✅ 点号分隔
"100020"              // ✅ 纯数字（游戏常用）
"1013_key"            // ✅ 数字开头
"app_config.url"      // ✅ 混合格式
```

**自定义示例**：

```json
{
  // 只允许大写字母和下划线
  "i18nHover.keyPattern": "^[A-Z][A-Z0-9_]*$"
}
```

### 3. 额外匹配规则 (additionalPatterns)

**说明**：添加额外的 key 匹配规则（不覆盖主规则）

**默认值**：`[]`（空数组）

**使用场景**：需要支持特殊格式的 key 时

**配置示例**：

```json
{
  "i18nHover.additionalPatterns": [
    "^msg_.*",        // 支持 msg_ 开头的key
    "^err_.*",        // 支持 err_ 开头的key
    "^i18n\\..+"      // 支持 i18n.xxx 格式
  ]
}
```

### 4. 函数匹配列表 (functionPatterns) ⭐

**说明**：定义哪些函数调用中的字符串才被识别为翻译 key

**默认值**：内置 15 个常用函数模式

默认支持的函数：

```javascript
Language.GetContent("key")      // Unity 常用
GameUtil.ShowTips("key")        // 游戏常用
i18n.t("key")                   // i18n 库
translate("key")                // 通用
t("key")                        // 简写
// ... 还有 10 个
```

**为什么需要这个配置？**

避免将所有字符串都当作翻译 key，实现智能识别。

**添加自定义函数**：

```json
{
  "i18nHover.functionPatterns": [
    // 保留默认函数（复制过来）
    "Language\\.GetContent\\s*\\([^\"']*$",
    "i18n\\.t\\s*\\([^\"']*$",
    "translate\\s*\\([^\"']*$",
    
    // 添加自定义函数
    "MyApp\\.getText\\s*\\([^\"']*$",
    "T\\s*\\([^\"']*$"
  ]
}
```

⚠️ **注意**：设置此项会**完全覆盖**默认值，不是追加。如果需要保留默认函数，必须将默认值也复制过来。

### 5. 中文反向查找结果数量 (maxReverseResults)

**说明**：控制中文反向查找时显示的最大结果数量

**默认值**：`5`

**取值范围**：1-20

**配置示例**：

```json
{
  "i18nHover.maxReverseResults": 10  // 显示 10 个匹配结果
}
```

**建议值**：

- **3-5**：快速查看最匹配的结果（推荐）
- **6-10**：需要查看更多可能的匹配
- **11-20**：完整查看所有可能的 key

### 6. 启用/禁用扩展 (enabled)

**说明**：全局启用或禁用扩展功能

**默认值**：`true`

**配置示例**：

```json
{
  "i18nHover.enabled": false  // 禁用扩展
}
```

## 🎯 配置优先级

```
用户设置 > 工作区设置 > 默认配置
```

**说明**：

1. **用户设置**：`Ctrl+,` → 用户 → 影响所有项目
2. **工作区设置**：`.vscode/settings.json` → 只影响当前项目
3. **默认配置**：`package.json` → 扩展内置

## 📝 配置示例

### 小型项目（零配置）

```json
{
  // 无需任何配置
  // 在根目录放 translations.txt 即可
}
```

### 标准 Web 项目

```json
{
  "i18nHover.translationFilePath": "locales/zh_CN.txt",
  "i18nHover.functionPatterns": [
    "i18n\\.t\\s*\\([^\"']*$",
    "translate\\s*\\([^\"']*$",
    "$t\\s*\\([^\"']*$"
  ]
}
```

### Unity 游戏项目

```json
{
  // 无需配置路径（自动识别 Unity 结构）
  "i18nHover.keyPattern": "^[0-9]+$",  // 只匹配纯数字 key
  "i18nHover.functionPatterns": [
    "Language\\.GetContent\\s*\\([^\"']*$",
    "GameUtil\\.ShowTips\\s*\\([^\"']*$",
    "UIManager\\.SetText\\s*\\([^\"']*$"
  ]
}
```

### 企业级项目

```json
{
  "i18nHover.translationFilePath": "D:/company/shared/i18n/zh_CN.txt",
  "i18nHover.keyPattern": "^[A-Z][A-Z0-9_]*$",
  "i18nHover.additionalPatterns": [
    "^ERROR_.*",
    "^MSG_.*"
  ],
  "i18nHover.maxReverseResults": 10
}
```

## 🔍 查看当前配置

### 方法 1：设置 UI（推荐）

1. 按 `Ctrl+,` 打开设置
2. 搜索 "i18n Hover"
3. 查看所有配置项及其当前值

### 方法 2：设置 JSON

1. 按 `Ctrl+Shift+P`
2. 输入 "Preferences: Open Settings (JSON)"
3. 搜索 `i18nHover`

### 方法 3：查看工作区设置

查看 `.vscode/settings.json` 文件

## ⚠️ 常见误区

### ❌ 误区 1：认为 additionalPatterns 会覆盖 keyPattern

**错误**：设置 `additionalPatterns` 会替换 `keyPattern`

**正确**：`additionalPatterns` 是**追加**规则，不会覆盖 `keyPattern`

### ❌ 误区 2：认为 functionPatterns 会追加

**错误**：设置 `functionPatterns` 会在默认值基础上追加

**正确**：设置 `functionPatterns` 会**完全覆盖**默认值

如果需要保留默认函数，必须将默认值也复制过来。

### ❌ 误区 3：在代码中查找默认值

**错误**：在 `extension.js` 中查找默认配置

**正确**：所有默认配置都在 `package.json` 的 `contributes.configuration.properties` 中定义

## ✅ 最佳实践

1. **优先使用默认配置**：大多数情况下无需修改
2. **最小化配置**：只修改必要的配置项
3. **使用工作区设置**：项目特定配置放在 `.vscode/settings.json`
4. **备份配置**：重要配置应该版本控制（提交 `.vscode/settings.json`）
5. **文档化**：在项目 README 中说明需要的配置

## 🆘 配置问题排查

### 问题 1：翻译文件加载失败

**现象**：状态栏显示 `$(error) i18n 加载错误`

**排查步骤**：

1. 检查文件路径是否正确
2. 检查文件是否存在
3. 查看状态栏的详细错误信息
4. 尝试重新加载（`Ctrl+Shift+P` → "重新加载翻译文件"）

**解决方案**：

- 如果使用默认路径：确保 `translations.txt` 在根目录
- 如果自定义路径：检查配置的路径是否正确
- 如果 Unity 项目：确保路径为 `Library/EditorPerssitent/Locale/translation.txt`

### 问题 2：悬停没有显示翻译

**可能原因**：

1. 字符串不在配置的函数中
2. key 格式不匹配配置的规则
3. 翻译文件未加载

**排查步骤**：

1. 检查状态栏：确认翻译文件已加载
2. 尝试强制模式：按 `Ctrl+Shift+H` 切换到强制查找模式
3. 检查函数配置：确认你的函数在 `functionPatterns` 中

### 问题 3：自定义函数不生效

**可能原因**：正则表达式格式错误

**解决方案**：

检查正则表达式格式：

```json
{
  // ✅ 正确：转义点号和括号
  "MyApp\\.getText\\s*\\([^\"']*$"
  
  // ❌ 错误：没有转义
  "MyApp.getText()"
}
```

## 📚 相关文档

- [快速上手指南](./快速上手.md) - 5 分钟快速开始
- [功能指南](./功能指南.md) - 详细功能说明
- [README](../README.md) - 扩展概览

---

**提示**：大多数用户只需要使用默认配置，无需任何设置！

